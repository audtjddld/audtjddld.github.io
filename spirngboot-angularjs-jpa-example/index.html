<!DOCTYPE html>

<html>
<head>

    <!-- CSS (load bootstrap) -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" ></link>
    <style>
        .navbar { border-radius:0; }
    </style>

    <title>springboot,angularjs,ui-router example 예제~</title>
</head>

<!-- apply our angular app to our site -->
<body ng-app="routerApp">
<!-- NAVIGATION -->
<nav class="navbar navbar-inverse" role="navigation">
    <div class="navbar-header">
    </div>
    <ul class="nav navbar-nav">
    </ul>
</nav>

<!-- MAIN CONTENT -->
<!-- THIS IS WHERE WE WILL INJECT OUR CONTENT ============================== -->
<div class="text-center">
<h1>AngularJS + Springboot + JPA 개발 <small>작성자 : 정명성</small></h1>

<p class="lead">
	Front를 MVVM 방식인 AngularJS로 개발하고, 서버단을 Spring Boot 그리고 ORM을 JPA로 개발하는 방식으로 간단한 예제 및 개념으로 정리를 시작.
</p>
 
<code>
우선 Angularjs에 대하여 간략하게 소개.

HTML은 정적문서를 선언하기에 좋지만, 웹 어플리케이션을 개발할때 동적 뷰를 선언하기 위해서는 기존 javascript나 jquery로는 많은 코딩라인을 소비하게 됩니다. 그리고 각 개발자마다 개발 방식이나 방법이 다르기 때문에 서로 연관없는 부분에서 꼬여버릴 수도 있습니다.
AngularJS는 HTML 문법을 확장할 수 있고 다양한 표현 및 개발을 빠르게 할 수 있습니다.



https://angularjs.org/

위 내용이 공식 사이트 설명이다.


개인적으로는 MVVM(Model-View-ViewModel ) 의 개념이 바로잡히지 않아 고생을 많이 했다.
jQeury 및 javascript로 DOM 선택하고 제어하여 동적인 view를 꾸미는게 익숙하였는데, AngularJS에서는 ViewModel를 이용하여 View의 DOM을 동적으로 제어해주는 방식. 간단하게 화면에 바인딩시켜놓은 Model(Data)를 AngularJS로 제어하면 View의 DOM은 동적으로 구성이 된다는 이야기이다. (개인적으로 어느정도 적응 기간이 필요하다고 생각되었다.)


그리고 자바스크립트와 jquery등과 비교한 내용도 아래 링크를 참조하시길 바란다.
https://www.airpair.com/angularjs/posts/jquery-angularjs-comparison-migration-walkthrough

이번에 게시판 CRUD를 하면서 사용한 framework는 다음과 같다.

UI-router, SPRING, SPRING JPA


예제소스 : https://github.com/audtjddld/jpa_example



UI-Router

https://angular-ui.github.io/ui-router/

UI-Router 란 화면의 ng-view에 state로 나누어놓은 화면을 바인딩시켜서 보여줄 수 있고, 기존 angular 라이브러리 내에 존재하는 $route 시스템과는 다른 것이다. UI-Router는 state로 구성되고 임의로 다른 기능을 붙일 수도 있다.

간단하게 말하자면 Spring을 이용해서 Controller 내에 url을 만들지 않아도 UI-Router를 이용하여 state로 구성된 View Template를 UI-View 영역에 붙일 수 있다. 단, 새로고침시에 문제가 발생되는 부분이 있다.

브라우저 새로고침시 문제가 발생된다고 언급한 이유는 UI-Router로 해당 화면의 state를 보여주면서 브라우저 URL도 변경이 가능하다. 한마디로 주소창의 URL을 변경해서 보여주는데 새로고침시 router가 정의되지 않은 페이지로 이동을 하지 못한다면, WebServer 를 거친 뒤 WAS로 넘어가 Spring framework 내에 Controller를 찾기 때문에 404에러가 발생한다는 이야기이다.

따라서 각 Router 별 1번째 depth 마다 기본 index.html 페이지로 이동하도록 한 뒤 Router를 탈 수 있도록 작업을 해줘야 한다.

ex) /user/list




위와 같은 방식으로 만들어줘야 된다.
그리고 UI-Router 의 url 패턴은 항상 /user/를 포함하는 방식으로 구성되어야 새로고침시 index.html 페이지로 이동하여 다시 해당 view로 이동할 수 있다.



그림으로 보자면 대략 이런 구조이다.


 위의 그림과 같이 변경된 URL을 이용해서 보고 있던 페이지로 이동하기 위해서는 ui-router를 선언한 기본 페이지로 이동해야 된다는 것이다.


AngularJS 각 요소 구성.

AngularJS 내에 controller, router, config,directive, filter 등이 사용되는데, jQuery와 같이 Chain형식으로 계속해서 기능을 추가할 수 있다. 따라서 각각 js로 나누었다. 그리고 추가 될때마다 각 부분에 추가하였다.



위의 캡쳐 화면과 같이 구성하였으며 아래와 같이 기능을 구성하였다.



router.js

directive.js

filter.js

controller.js

config.js



위와 같이 config.js 를 상단에 넣고 myApp 을 정의시킨 뒤, 체인형태로 계속 기능들을 달아주었다.

그리고 config를 따로 두었기 때문에 추가적으로 라이브러리를 주입시킬때 config.js 내에 angular.module에 선언하면 관리하기 편할 것 같았다.

하지만 개인적인 생각이므로 너무 다른 방법도 있을 수 있다.


그리고 state로 이동되는 페이지 template는 Spring boot 내에 정적인 파일들 저장소 /resources/static 에 저장시켜서 불러오도록 하였다.



/resources/templates/ 폴더 안으로 넣을 경우 Controller 내에 해당 html을 불러올 수 있도록 만들어줘야하기 때문에 정적인 페이지로 이동 되도록 구성하였다. 

UI-Router에서 url 중 ‘^’ 표시가 되어있는 경우 먼저 있던 url에 이어서 만들 수 있도록 해준다.




 무슨 이야기냐면 기존에 /user/list 에서 다른 state로 이동하여 /user/detail 이라는 url을 ‘^’없이 셋팅하게 되면 /user/list/user/detail 형식으로 붙게 된다. 하지만 ^/user/detail 을 하게 되면
기존 url에 user가 포함된 부분을 제외하고 뒷 부분이 추가가된다.

그리고 URL 중 Path에 Parameter로 오는 것은 ‘:’ 을 사용하여 표시해주고 parameter로 오는 것은 ?파라미터 명 형식으로 붙여주면 파라미터가 전달되서 이동된다.



ui-sref=”userDetail({id : d._id})” 를 보자면 ui-sref 로 이동되는 state로 parameter를 전할 하는
방식이고 위에 userDetail state에 url에 패턴형식으로 id값이 넘어간다는 것이다.

그리고 AngularJS controller쪽에서 받을때는 $stateParams 객체에 담겨옴으로 $stateParams.변수이름 으로 해서 받을 수 있다.

</code>



        <section id="downloads" class="clearfix">
          <a href="https://github.com/audtjddld" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>    
</div>

<div class="container">
    <div ui-view="">

    </div>
</div>



</body>
    <!-- JS (load angular, ui-router, and our custom js file) -->
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.8/angular-ui-router.min.js" type="text/javascript"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular-animate.js" type="text/javascript"></script>
     
</html>
